<table *ngIf="!registerAnswersFlag; else template">
  <thead class="mat-elevation-z1">
    <tr>
      <th>ID</th>
      <th>SALA</th>
      <th>ESCOLA</th>
      <th>ANO</th>
      <th>BIMESTRE</th>
      <th>CATEGORIA</th>
      <th>NOME</th>
      <th>CRIADOR</th>
      <th>MATÉRIA</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let item of data">
      <tr class="trid">
        <td [attr.rowspan]="item.classes.length + 1">{{item.testId}}</td>
      </tr>
      <tr *ngFor="let object of item.classes;" class="clickable" (click)="registerAnswers({testId: item.testId, classId: object.classroomId, classroom: object.classroom, school: object.school})">
        <td>{{ object.classroom }}</td>
        <td>{{ object.school }}</td>
        <td>{{ object.year }}</td>
        <td>{{ object.bimester }}</td>
        <td>{{ object.category }}</td>
        <td>{{ object.name }}</td>
        <td>{{ object.teacher }}</td>
        <td>{{ object.discipline }}</td>
      </tr>
    </ng-container>
  </tbody>
</table>
<ng-template #template>
  <table>
    <thead class="mat-elevation-z1">
      <tr>
        <th class="school" [attr.colspan]="100">{{school}}</th>
      </tr>
      <tr>
        <th>
          <div>
            <span>SALA: {{classroom}}</span>
            <span>GABARITO:</span>
          </div>
        </th>
        <th style="background-color: #3f92ff" class="question" *ngFor="let question of response.test.questions">
          {{ question.answer }}
        </th>
        <th class="question" [attr.rowspan]="2">TOTAL</th>
      </tr>
      <tr>
        <th>
          <div>
            <span>ALUNOS</span>
            <span>QUESTÕES:</span>
          </div>
        </th>
        <th style="background-color: #3f92ff" class="question" *ngFor="let question of response.test.questions">
          {{ question.id }}
        </th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let student of response.students">
        <td class="name">{{ student.person.name }}</td>
        <ng-container *ngFor="let studentTest of student.studentTests">
          <ng-container *ngFor="let element of studentTest.studentAnswers">

            <td class="answer">
              <input
                #input
                (blur)="updateAnswers(studentTest, studentTest.studentAnswers, { id: element.id, answer: input.value.toUpperCase()})"
                maxlength="1"
                type="text"
                [value]="element.answer.toUpperCase()"
                [ngStyle]="{ 'background-color': color({ id: element.id, answer: input.value.toUpperCase()}) }"
              >
            </td>
          </ng-container>
        </ng-container>
        <td class="answer">{{ studentTotal(student.studentTests[0].studentAnswers) }}</td>
      </tr>
    </tbody>
  </table>
</ng-template>
